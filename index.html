<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Portf√≥lio Vivo üì∏</title>
    <style>
        /* (Mantive seus estilos originais para poupar espa√ßo, adicionei apenas o necess√°rio) */
        :root { --primary: #4A90E2; --bg: #F0F2F5; --danger: #ef4444; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        header { background: white; padding: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; }
        .editor { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-top: 4px solid var(--primary); }
        .card-post { background: white; border-radius: 12px; margin-bottom: 20px; overflow: hidden; border: 1px solid #ddd; }
        .post-header { padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        .post-image { width: 100%; display: block; max-height: 400px; object-fit: cover; }
        .post-content { padding: 15px; }
        input, textarea { width: 100%; margin-bottom: 10px; padding: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; }
        .btn-save { background: var(--primary); color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-delete { color: var(--danger); cursor: pointer; border: none; background: none; font-weight: bold; }
        .hidden { display: none; }
        #user-photo { width: 35px; border-radius: 50%; }
    </style>
</head>
<body>

    <header class="container">
        <h1>üì∏ Portf√≥lio</h1>
        <button id="btn-login" style="padding: 5px 15px;">Login Google</button>
        <div id="user-display" class="hidden">
            <img id="user-photo" src="">
            <button id="btn-logout" style="color: red; border: none; background: none; cursor: pointer;">Sair</button>
        </div>
    </header>

    <main class="container">
        <section id="editor-section" class="editor hidden">
            <h3>‚ú® Nova Conquista</h3>
            <input type="text" id="skill-input" placeholder="T√≠tulo">
            <textarea id="exp-input" placeholder="O que aprendeu?"></textarea>
            <p style="font-size: 0.8rem;">Foto (M√°x 1MB): <input type="file" id="image-input" accept="image/*"></p>
            <button id="btn-save" class="btn-save">Publicar no Portf√≥lio</button>
        </section>

        <div id="timeline"></div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAxWEuumY-TGqhHb1KxV6bDiQJ6ugxvJA8",
            authDomain: "curriculovivo.firebaseapp.com",
            projectId: "curriculovivo",
            storageBucket: "curriculovivo.appspot.com",
            messagingSenderId: "245934457904",
            appId: "1:245934457904:web:0cdd30c1b145cfd4b119f5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // Login/Logout
        document.getElementById('btn-login').onclick = () => signInWithPopup(auth, provider);
        document.getElementById('btn-logout').onclick = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('btn-login').classList.add('hidden');
                document.getElementById('user-display').classList.remove('hidden');
                document.getElementById('editor-section').classList.remove('hidden');
                document.getElementById('user-photo').src = user.photoURL;
                carregarFeed(user.uid);
            } else {
                document.getElementById('btn-login').classList.remove('hidden');
                document.getElementById('user-display').classList.add('hidden');
                document.getElementById('editor-section').classList.add('hidden');
                document.getElementById('timeline').innerHTML = "";
            }
        });

        // Fun√ß√£o para converter imagem em texto (Base64)
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        document.getElementById('btn-save').onclick = async () => {
            const title = document.getElementById('skill-input').value;
            const desc = document.getElementById('exp-input').value;
            const file = document.getElementById('image-input').files[0];

            if (!title || !desc || !file) return alert("Preencha tudo!");
            if (file.size > 1048576) return alert("Foto muito grande! Use uma de at√© 1MB.");

            document.getElementById('btn-save').innerText = "Processando...";
            
            try {
                const base64Image = await toBase64(file);
                await addDoc(collection(db, "experiencias"), {
                    uid: auth.currentUser.uid,
                    userName: auth.currentUser.displayName,
                    userPhoto: auth.currentUser.photoURL,
                    titulo: title,
                    descricao: desc,
                    imageUrl: base64Image, // Foto salva como texto!
                    data: new Date()
                });
                document.getElementById('skill-input').value = "";
                document.getElementById('exp-input').value = "";
                document.getElementById('image-input').value = "";
            } catch (e) { alert("Erro ao salvar!"); }
            document.getElementById('btn-save').innerText = "Publicar no Portf√≥lio";
        };

        function carregarFeed(uid) {
            const q = query(collection(db, "experiencias"), where("uid", "==", uid), orderBy("data", "desc"));
            onSnapshot(q, (snapshot) => {
                const timeline = document.getElementById('timeline');
                timeline.innerHTML = "";
                snapshot.forEach(docSnap => {
                    const post = docSnap.data();
                    const div = document.createElement('div');
                    div.className = 'card-post';
                    div.innerHTML = `
                        <div class="post-header"><span>${post.userName}</span><button class="btn-delete" onclick="window.excluirPost('${docSnap.id}')">Excluir</button></div>
                        <img src="${post.imageUrl}" class="post-image">
                        <div class="post-content"><h3>${post.titulo}</h3><p>${post.descricao}</p></div>
                    `;
                    timeline.appendChild(div);
                });
            });
        }

        window.excluirPost = async (id) => {
            if (confirm("Apagar?")) await deleteDoc(doc(db, "experiencias", id));
        };
    </script>
</body>
</html>
